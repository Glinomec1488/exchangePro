{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect } from \"react\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { serveUrl } from \"../config\";\nimport { useAppDispatch, useAppSelector } from \"../store/hooks\";\nimport { dispatchOrder } from \"../store/slices/exchange\";\nimport { io } from \"socket.io-client\";\nimport axios from \"axios\";\nconst useOrderInfo = () => {\n  _s();\n  const {\n    orderId\n  } = useParams();\n  const socket = io(\"http://172.16.10.3:60\");\n  const order = useAppSelector(state => state.exchange.orderInfo);\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n  const getOrder = async () => {\n    const order = await fetch(`${serveUrl}/order/${orderId}`).then(res => res.json());\n    if (order.error) {\n      navigate(\"/\");\n    }\n    dispatch(dispatchOrder(order));\n  };\n  const confirmOrder = async () => {\n    try {\n      await fetch(`${serveUrl}/confirm/${orderId}`, {\n        method: \"POST\"\n      }).then(res => res.json());\n      window.location.reload();\n    } catch (error) {\n      console.error(error.message);\n    }\n  };\n  useEffect(() => {\n    if (!order) {\n      getOrder();\n    }\n  }, [orderId]);\n  useEffect(() => {\n    console.log(\"init\");\n    const socket = io(\"http://172.16.10.3:60\");\n    const eventSource = new EventSource(`${serveUrl}/confirm/${orderId}`);\n    socket.on(\"redirect_user\", async data => {\n      const response = await axios.post(`${serveUrl}/confirm/${orderId}/passed`, {\n        transID: data.transID,\n        redirect_url: `google.com`\n      });\n      const redirectUrl = response.data.redirect_url;\n      navigate(redirectUrl);\n    });\n    return () => {\n      eventSource.close();\n    };\n  }, [navigate]);\n  return {\n    orderInfo: order,\n    orderId,\n    confirmOrder\n  };\n};\n_s(useOrderInfo, \"MBMcXpfv0Jp3Hu0/5xDaNWGaCGo=\", false, function () {\n  return [useParams, useAppSelector, useAppDispatch, useNavigate];\n});\nexport default useOrderInfo;","map":{"version":3,"names":["useEffect","useNavigate","useParams","serveUrl","useAppDispatch","useAppSelector","dispatchOrder","io","axios","useOrderInfo","orderId","socket","order","state","exchange","orderInfo","dispatch","navigate","getOrder","fetch","then","res","json","error","confirmOrder","method","window","location","reload","console","message","log","eventSource","EventSource","on","data","response","post","transID","redirect_url","redirectUrl","close"],"sources":["C:/Users/1/Downloads/fakeex/client/src/hooks/useOrderInfo.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useNavigate, useParams, redirectDocument } from \"react-router-dom\";\r\nimport { serveUrl } from \"../config\";\r\nimport { useAppDispatch, useAppSelector } from \"../store/hooks\";\r\nimport { dispatchOrder } from \"../store/slices/exchange\";\r\nimport { io } from \"socket.io-client\";\r\nimport axios from \"axios\";\r\nimport orderId from \"../hooks/useOrderInfo\";\r\n\r\nconst useOrderInfo = () => {\r\n  const { orderId } = useParams();\r\n  const socket = io(\"http://172.16.10.3:60\");\r\n  const order = useAppSelector((state) => state.exchange.orderInfo);\r\n  const dispatch = useAppDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const getOrder = async () => {\r\n    const order = await fetch(`${serveUrl}/order/${orderId}`).then((res) =>\r\n      res.json()\r\n    );\r\n\r\n    if (order.error) {\r\n      navigate(\"/\");\r\n    }\r\n\r\n    dispatch(dispatchOrder(order));\r\n  };\r\n\r\n  const confirmOrder = async () => {\r\n    try {\r\n      await fetch(`${serveUrl}/confirm/${orderId}`, {\r\n        method: \"POST\",\r\n      }).then((res) => res.json());\r\n      window.location.reload();\r\n    } catch (error: any) {\r\n      console.error(error.message);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!order) {\r\n      getOrder();\r\n    }\r\n  }, [orderId]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"init\");\r\n    const socket = io(\"http://172.16.10.3:60\");\r\n    const eventSource = new EventSource(`${serveUrl}/confirm/${orderId}`);\r\n\r\n    socket.on(\"redirect_user\", async (data) => {\r\n      const response = await axios.post(\r\n        `${serveUrl}/confirm/${orderId}/passed`,\r\n        {\r\n          transID: data.transID,\r\n          redirect_url: `google.com`,\r\n        }\r\n      );\r\n      const redirectUrl = response.data.redirect_url;\r\n      navigate(redirectUrl);\r\n    });\r\n\r\n    return () => {\r\n      eventSource.close();\r\n    };\r\n  }, [navigate]);\r\n\r\n  return {\r\n    orderInfo: order,\r\n    orderId,\r\n    confirmOrder,\r\n  };\r\n};\r\n\r\nexport default useOrderInfo;\r\n"],"mappings":";AAAA,SAASA,SAAS,QAAkB,OAAO;AAC3C,SAASC,WAAW,EAAEC,SAAS,QAA0B,kBAAkB;AAC3E,SAASC,QAAQ,QAAQ,WAAW;AACpC,SAASC,cAAc,EAAEC,cAAc,QAAQ,gBAAgB;AAC/D,SAASC,aAAa,QAAQ,0BAA0B;AACxD,SAASC,EAAE,QAAQ,kBAAkB;AACrC,OAAOC,KAAK,MAAM,OAAO;AAGzB,MAAMC,YAAY,GAAG,MAAM;EAAA;EACzB,MAAM;IAAEC;EAAQ,CAAC,GAAGR,SAAS,EAAE;EAC/B,MAAMS,MAAM,GAAGJ,EAAE,CAAC,uBAAuB,CAAC;EAC1C,MAAMK,KAAK,GAAGP,cAAc,CAAEQ,KAAK,IAAKA,KAAK,CAACC,QAAQ,CAACC,SAAS,CAAC;EACjE,MAAMC,QAAQ,GAAGZ,cAAc,EAAE;EACjC,MAAMa,QAAQ,GAAGhB,WAAW,EAAE;EAE9B,MAAMiB,QAAQ,GAAG,YAAY;IAC3B,MAAMN,KAAK,GAAG,MAAMO,KAAK,CAAE,GAAEhB,QAAS,UAASO,OAAQ,EAAC,CAAC,CAACU,IAAI,CAAEC,GAAG,IACjEA,GAAG,CAACC,IAAI,EAAE,CACX;IAED,IAAIV,KAAK,CAACW,KAAK,EAAE;MACfN,QAAQ,CAAC,GAAG,CAAC;IACf;IAEAD,QAAQ,CAACV,aAAa,CAACM,KAAK,CAAC,CAAC;EAChC,CAAC;EAED,MAAMY,YAAY,GAAG,YAAY;IAC/B,IAAI;MACF,MAAML,KAAK,CAAE,GAAEhB,QAAS,YAAWO,OAAQ,EAAC,EAAE;QAC5Ce,MAAM,EAAE;MACV,CAAC,CAAC,CAACL,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACC,IAAI,EAAE,CAAC;MAC5BI,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE;IAC1B,CAAC,CAAC,OAAOL,KAAU,EAAE;MACnBM,OAAO,CAACN,KAAK,CAACA,KAAK,CAACO,OAAO,CAAC;IAC9B;EACF,CAAC;EAED9B,SAAS,CAAC,MAAM;IACd,IAAI,CAACY,KAAK,EAAE;MACVM,QAAQ,EAAE;IACZ;EACF,CAAC,EAAE,CAACR,OAAO,CAAC,CAAC;EAEbV,SAAS,CAAC,MAAM;IACd6B,OAAO,CAACE,GAAG,CAAC,MAAM,CAAC;IACnB,MAAMpB,MAAM,GAAGJ,EAAE,CAAC,uBAAuB,CAAC;IAC1C,MAAMyB,WAAW,GAAG,IAAIC,WAAW,CAAE,GAAE9B,QAAS,YAAWO,OAAQ,EAAC,CAAC;IAErEC,MAAM,CAACuB,EAAE,CAAC,eAAe,EAAE,MAAOC,IAAI,IAAK;MACzC,MAAMC,QAAQ,GAAG,MAAM5B,KAAK,CAAC6B,IAAI,CAC9B,GAAElC,QAAS,YAAWO,OAAQ,SAAQ,EACvC;QACE4B,OAAO,EAAEH,IAAI,CAACG,OAAO;QACrBC,YAAY,EAAG;MACjB,CAAC,CACF;MACD,MAAMC,WAAW,GAAGJ,QAAQ,CAACD,IAAI,CAACI,YAAY;MAC9CtB,QAAQ,CAACuB,WAAW,CAAC;IACvB,CAAC,CAAC;IAEF,OAAO,MAAM;MACXR,WAAW,CAACS,KAAK,EAAE;IACrB,CAAC;EACH,CAAC,EAAE,CAACxB,QAAQ,CAAC,CAAC;EAEd,OAAO;IACLF,SAAS,EAAEH,KAAK;IAChBF,OAAO;IACPc;EACF,CAAC;AACH,CAAC;AAAC,GA/DIf,YAAY;EAAA,QACIP,SAAS,EAEfG,cAAc,EACXD,cAAc,EACdH,WAAW;AAAA;AA4D9B,eAAeQ,YAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}