{"ast":null,"code":"import _toConsumableArray from\"C:/Users/diarrhea/Downloads/exchangePro-main/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/diarrhea/Downloads/exchangePro-main/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/diarrhea/Downloads/exchangePro-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/diarrhea/Downloads/exchangePro-main/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{getEnv}from'../../../../utils';var url=getEnv(process.env.REACT_APP_SERVER_URL,'REACT_APP_SERVER_URL');var useHistory=function useHistory(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),history=_useState2[0],setHistory=_useState2[1];var getHistory=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var historyRes;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"\".concat(url,\"/transactions\")).then(function(res){return res.json();});case 3:historyRes=_context.sent;setHistory(historyRes.map(function(elem){return{txHash:elem.txHash,block:elem.block,fromm:elem.fromm,to:elem.to,value:elem.value};}));_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.error(_context.t0.message);case 10:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return function getHistory(){return _ref.apply(this,arguments);};}();useEffect(function(){if(history.length===0)getHistory();});useEffect(function(){var timer=setInterval(function(){fetch(\"\".concat(url,\"/genTrans\")).then(function(res){return res.json();}).then(function(res){var slicedHistory=history.slice(0,-1);setHistory([{txHash:res.txHash,block:res.block,fromm:res.fromAddress,to:res.to,value:res.value}].concat(_toConsumableArray(slicedHistory)));});},5000);return function(){clearInterval(timer);};});return{history:history};};export default useHistory;","map":{"version":3,"names":["useState","useEffect","getEnv","url","process","env","REACT_APP_SERVER_URL","useHistory","history","setHistory","getHistory","fetch","then","res","json","historyRes","map","elem","txHash","block","fromm","to","value","console","error","message","length","timer","setInterval","slicedHistory","slice","fromAddress","clearInterval"],"sources":["C:/Users/diarrhea/Downloads/exchangePro-main/client/src/screens/home/components/txHistory/useHistory.ts"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { getEnv } from '../../../../utils'\n\nconst url = getEnv(process.env.REACT_APP_SERVER_URL, 'REACT_APP_SERVER_URL')\n\nexport interface IHistoryItem {\n    block: string,\n    fromm: string,\n    to: string,\n    txHash: string,\n    value: string,\n}\n\nconst useHistory = () => {\n    const [history, setHistory] = useState<IHistoryItem[]>([])\n\n    const getHistory = async () => {\n        try {\n            const historyRes: IHistoryItem[] = await fetch(`${url}/transactions`).then(res => res.json())\n            setHistory(historyRes.map(elem => (\n                {\n                    txHash: elem.txHash,\n                    block: elem.block,\n                    fromm: elem.fromm,\n                    to: elem.to,\n                    value: elem.value\n                }\n            )))\n        } catch (error: any) {\n            console.error(error.message)\n        }\n    }\n\n    useEffect(() => {\n        if (history.length === 0) getHistory()\n    })\n\n    useEffect(() => {\n        const timer = setInterval(() => {\n            fetch(`${url}/genTrans`)\n                .then(res => res.json())\n                .then(res => {\n                    const slicedHistory = history.slice(0, -1)\n                    setHistory([\n                        {\n                            txHash: res.txHash,\n                            block: res.block,\n                            fromm: res.fromAddress,\n                            to: res.to,\n                            value: res.value\n                        },\n                        ...slicedHistory\n                    ])\n                })\n        }, 5000)\n\n        return () => {\n            clearInterval(timer)\n        }\n    })\n\n    return {\n        history\n    }\n}\n\nexport default useHistory"],"mappings":"4jBAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,OAASC,MAAM,KAAQ,mBAAmB,CAE1C,GAAMC,IAAG,CAAGD,MAAM,CAACE,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAAE,sBAAsB,CAAC,CAU5E,GAAMC,WAAU,CAAG,QAAbA,WAAU,EAAS,CACrB,cAA8BP,QAAQ,CAAiB,EAAE,CAAC,wCAAnDQ,OAAO,eAAEC,UAAU,eAE1B,GAAMC,WAAU,4FAAG,yLAE8BC,MAAK,WAAIR,GAAG,kBAAgB,CAACS,IAAI,CAAC,SAAAC,GAAG,QAAIA,IAAG,CAACC,IAAI,EAAE,GAAC,QAAvFC,UAA0B,eAChCN,UAAU,CAACM,UAAU,CAACC,GAAG,CAAC,SAAAC,IAAI,QAC1B,CACIC,MAAM,CAAED,IAAI,CAACC,MAAM,CACnBC,KAAK,CAAEF,IAAI,CAACE,KAAK,CACjBC,KAAK,CAAEH,IAAI,CAACG,KAAK,CACjBC,EAAE,CAAEJ,IAAI,CAACI,EAAE,CACXC,KAAK,CAAEL,IAAI,CAACK,KAChB,CAAC,EACJ,CAAC,CAAC,gFAEHC,OAAO,CAACC,KAAK,CAAC,YAAMC,OAAO,CAAC,oEAEnC,kBAfKf,WAAU,0CAef,CAEDT,SAAS,CAAC,UAAM,CACZ,GAAIO,OAAO,CAACkB,MAAM,GAAK,CAAC,CAAEhB,UAAU,EAAE,CAC1C,CAAC,CAAC,CAEFT,SAAS,CAAC,UAAM,CACZ,GAAM0B,MAAK,CAAGC,WAAW,CAAC,UAAM,CAC5BjB,KAAK,WAAIR,GAAG,cAAY,CACnBS,IAAI,CAAC,SAAAC,GAAG,QAAIA,IAAG,CAACC,IAAI,EAAE,GAAC,CACvBF,IAAI,CAAC,SAAAC,GAAG,CAAI,CACT,GAAMgB,cAAa,CAAGrB,OAAO,CAACsB,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,CAC1CrB,UAAU,EACN,CACIS,MAAM,CAAEL,GAAG,CAACK,MAAM,CAClBC,KAAK,CAAEN,GAAG,CAACM,KAAK,CAChBC,KAAK,CAAEP,GAAG,CAACkB,WAAW,CACtBV,EAAE,CAAER,GAAG,CAACQ,EAAE,CACVC,KAAK,CAAET,GAAG,CAACS,KACf,CAAC,4BACEO,aAAa,GAClB,CACN,CAAC,CAAC,CACV,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,WAAM,CACTG,aAAa,CAACL,KAAK,CAAC,CACxB,CAAC,CACL,CAAC,CAAC,CAEF,MAAO,CACHnB,OAAO,CAAPA,OACJ,CAAC,CACL,CAAC,CAED,cAAeD,WAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}