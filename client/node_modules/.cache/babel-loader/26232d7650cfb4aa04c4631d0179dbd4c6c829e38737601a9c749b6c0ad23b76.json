{"ast":null,"code":"import _classCallCheck from \"E:/Users/1/Downloads/fakeex/client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"E:/Users/1/Downloads/fakeex/client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"E:/Users/1/Downloads/fakeex/client/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"E:/Users/1/Downloads/fakeex/client/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { Transport } from \"../transport.js\";\nimport { nextTick } from \"../globals.node.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream } from \"engine.io-parser\";\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nexport var WT = /*#__PURE__*/function (_Transport) {\n  _inherits(WT, _Transport);\n  var _super = _createSuper(WT);\n  function WT() {\n    _classCallCheck(this, WT);\n    return _super.apply(this, arguments);\n  }\n  _createClass(WT, [{\n    key: \"name\",\n    get: function get() {\n      return \"webtransport\";\n    }\n  }, {\n    key: \"doOpen\",\n    value: function doOpen() {\n      var _this = this;\n      try {\n        // @ts-ignore\n        this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n      } catch (err) {\n        return this.emitReserved(\"error\", err);\n      }\n      this._transport.closed.then(function () {\n        _this.onClose();\n      }).catch(function (err) {\n        _this.onError(\"webtransport error\", err);\n      });\n      // note: we could have used async/await, but that would require some additional polyfills\n      this._transport.ready.then(function () {\n        _this._transport.createBidirectionalStream().then(function (stream) {\n          var decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, _this.socket.binaryType);\n          var reader = stream.readable.pipeThrough(decoderStream).getReader();\n          var encoderStream = createPacketEncoderStream();\n          encoderStream.readable.pipeTo(stream.writable);\n          _this._writer = encoderStream.writable.getWriter();\n          var read = function read() {\n            reader.read().then(function (_ref) {\n              var done = _ref.done,\n                value = _ref.value;\n              if (done) {\n                return;\n              }\n              _this.onPacket(value);\n              read();\n            }).catch(function (err) {});\n          };\n          read();\n          var packet = {\n            type: \"open\"\n          };\n          if (_this.query.sid) {\n            packet.data = \"{\\\"sid\\\":\\\"\".concat(_this.query.sid, \"\\\"}\");\n          }\n          _this._writer.write(packet).then(function () {\n            return _this.onOpen();\n          });\n        });\n      });\n    }\n  }, {\n    key: \"write\",\n    value: function write(packets) {\n      var _this2 = this;\n      this.writable = false;\n      var _loop = function _loop() {\n        var packet = packets[i];\n        var lastPacket = i === packets.length - 1;\n        _this2._writer.write(packet).then(function () {\n          if (lastPacket) {\n            nextTick(function () {\n              _this2.writable = true;\n              _this2.emitReserved(\"drain\");\n            }, _this2.setTimeoutFn);\n          }\n        });\n      };\n      for (var i = 0; i < packets.length; i++) {\n        _loop();\n      }\n    }\n  }, {\n    key: \"doClose\",\n    value: function doClose() {\n      var _a;\n      (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n  }]);\n  return WT;\n}(Transport);","map":{"version":3,"names":["Transport","nextTick","createPacketDecoderStream","createPacketEncoderStream","WT","_transport","WebTransport","createUri","opts","transportOptions","name","err","emitReserved","closed","then","onClose","catch","onError","ready","createBidirectionalStream","stream","decoderStream","Number","MAX_SAFE_INTEGER","socket","binaryType","reader","readable","pipeThrough","getReader","encoderStream","pipeTo","writable","_writer","getWriter","read","done","value","onPacket","packet","type","query","sid","data","write","onOpen","packets","i","lastPacket","length","setTimeoutFn","_a","close"],"sources":["E:/Users/1/Downloads/fakeex/client/node_modules/engine.io-client/build/esm/transports/webtransport.js"],"sourcesContent":["import { Transport } from \"../transport.js\";\nimport { nextTick } from \"../globals.node.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream, } from \"engine.io-parser\";\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nexport class WT extends Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            this.onClose();\n        })\n            .catch((err) => {\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = createPacketEncoderStream();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            return;\n                        }\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}