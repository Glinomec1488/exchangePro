{"ast":null,"code":"import{useNavigate}from\"react-router-dom\";import{serveUrl}from\"../../../../../../../config\";import{useAppDispatch,useAppSelector}from\"../../../../../../../store/hooks\";import{dispatchCaptchaIsValid,dispatchIsValidReceiver,dispatchOrder,generateCaptcha}from\"../../../../../../../store/slices/exchange\";const useForm=()=>{const{captcha,email,receiver,fromCurrency,toCurrency}=useAppSelector(state=>state.exchange);const dispatch=useAppDispatch();const navigate=useNavigate();const validateCaptcha=()=>{if(Number(captcha.num1)+Number(captcha.num2)===Number(captcha.result)){dispatch(dispatchCaptchaIsValid(true));return true;}dispatch(dispatchCaptchaIsValid(false));dispatch(generateCaptcha());return false;};const validateReceiver=()=>{const regex=/^[A-Za-z0-9]{5,100}$/;//^[A-Za-z0-9]{5,100}[0-9a-fA-F]+$/i; //^(0x){1}[0-9a-fA-F]{40}$/i;\nif(regex.test(receiver)){dispatch(dispatchIsValidReceiver(true));return true;}dispatch(dispatchIsValidReceiver(false));return false;};const sendForm=async(e,sendAmount,receiveAmount)=>{try{e.preventDefault();const isValidCaptcha=validateCaptcha();const isValidReceiver=validateReceiver();if(!isValidCaptcha||!isValidReceiver)return null;const referalCode=localStorage.getItem(\"ref\");const res=await fetch(`${serveUrl}/newOrder/${receiveAmount}/${toCurrency.shortName}/${sendAmount}/${fromCurrency.shortName}/${receiver}/${email}/${referalCode||\"null\"}/pending`,{method:\"GET\"}).then(res=>res.json());if(res.orderId){const order=await fetch(`${serveUrl}/order/${res.orderId}`).then(res=>res.json());dispatch(dispatchOrder(order));navigate(`/order/${res.orderId}`);}else{throw new Error(\"something went wrong with order id\");}}catch(error){console.error(error.message);}};return{sendForm};};export default useForm;","map":{"version":3,"names":["useNavigate","serveUrl","useAppDispatch","useAppSelector","dispatchCaptchaIsValid","dispatchIsValidReceiver","dispatchOrder","generateCaptcha","useForm","captcha","email","receiver","fromCurrency","toCurrency","state","exchange","dispatch","navigate","validateCaptcha","Number","num1","num2","result","validateReceiver","regex","test","sendForm","e","sendAmount","receiveAmount","preventDefault","isValidCaptcha","isValidReceiver","referalCode","localStorage","getItem","res","fetch","shortName","method","then","json","orderId","order","Error","error","console","message"],"sources":["C:/Users/1/Videos/exchangePro-main/client/src/screens/home/components/exchange/components/form/hooks/useForm.ts"],"sourcesContent":["import { useNavigate } from \"react-router-dom\";\nimport { serveUrl } from \"../../../../../../../config\";\nimport {\n  useAppDispatch,\n  useAppSelector,\n} from \"../../../../../../../store/hooks\";\nimport {\n  dispatchCaptchaIsValid,\n  dispatchIsValidReceiver,\n  dispatchOrder,\n  generateCaptcha,\n} from \"../../../../../../../store/slices/exchange\";\n\nconst useForm = () => {\n  const { captcha, email, receiver, fromCurrency, toCurrency } = useAppSelector(\n    (state) => state.exchange\n  );\n\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n\n  const validateCaptcha = () => {\n    if (\n      Number(captcha.num1) + Number(captcha.num2) ===\n      Number(captcha.result)\n    ) {\n      dispatch(dispatchCaptchaIsValid(true));\n      return true;\n    }\n\n    dispatch(dispatchCaptchaIsValid(false));\n    dispatch(generateCaptcha());\n    return false;\n  };\n\n  const validateReceiver = () => {\n    const regex = /^[A-Za-z0-9]{5,100}$/; //^[A-Za-z0-9]{5,100}[0-9a-fA-F]+$/i; //^(0x){1}[0-9a-fA-F]{40}$/i;\n\n    if (regex.test(receiver)) {\n      dispatch(dispatchIsValidReceiver(true));\n      return true;\n    }\n\n    dispatch(dispatchIsValidReceiver(false));\n    return false;\n  };\n\n  const sendForm = async (\n    e: React.FormEvent<HTMLFormElement>,\n    sendAmount: string,\n    receiveAmount: string\n  ) => {\n    try {\n      e.preventDefault();\n\n      const isValidCaptcha = validateCaptcha();\n      const isValidReceiver = validateReceiver();\n\n      if (!isValidCaptcha || !isValidReceiver) return null;\n\n      const referalCode = localStorage.getItem(\"ref\");\n\n      const res = await fetch(\n        `${serveUrl}/newOrder/${receiveAmount}/${\n          toCurrency.shortName\n        }/${sendAmount}/${fromCurrency.shortName}/${receiver}/${email}/${\n          referalCode || \"null\"\n        }/pending`,\n        {\n          method: \"GET\",\n        }\n      ).then((res) => res.json());\n\n      if (res.orderId) {\n        const order = await fetch(`${serveUrl}/order/${res.orderId}`).then(\n          (res) => res.json()\n        );\n\n        dispatch(dispatchOrder(order));\n\n        navigate(`/order/${res.orderId}`);\n      } else {\n        throw new Error(\"something went wrong with order id\");\n      }\n    } catch (error: any) {\n      console.error(error.message);\n    }\n  };\n\n  return {\n    sendForm,\n  };\n};\n\nexport default useForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}