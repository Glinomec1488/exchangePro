{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/diarrhea/Documents/exchangePro-main/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/diarrhea/Documents/exchangePro-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{useNavigate}from\"react-router-dom\";import{serveUrl}from\"../../../../../../../config\";import{useAppDispatch,useAppSelector}from\"../../../../../../../store/hooks\";import{dispatchCaptchaIsValid,dispatchIsValidReceiver,dispatchOrder,generateCaptcha}from\"../../../../../../../store/slices/exchange\";var useForm=function useForm(){var _useAppSelector=useAppSelector(function(state){return state.exchange;}),captcha=_useAppSelector.captcha,email=_useAppSelector.email,receiver=_useAppSelector.receiver,fromCurrency=_useAppSelector.fromCurrency,toCurrency=_useAppSelector.toCurrency;var dispatch=useAppDispatch();var navigate=useNavigate();var validateCaptcha=function validateCaptcha(){if(Number(captcha.num1)+Number(captcha.num2)===Number(captcha.result)){dispatch(dispatchCaptchaIsValid(true));return true;}dispatch(dispatchCaptchaIsValid(false));dispatch(generateCaptcha());return false;};var validateReceiver=function validateReceiver(){var regex=/^[A-Za-z0-9]{5,100}$/;//^[A-Za-z0-9]{5,100}[0-9a-fA-F]+$/i; //^(0x){1}[0-9a-fA-F]{40}$/i;\nif(regex.test(receiver)){dispatch(dispatchIsValidReceiver(true));return true;}dispatch(dispatchIsValidReceiver(false));return false;};var sendForm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e,sendAmount,receiveAmount){var isValidCaptcha,isValidReceiver,referalCode,res,order;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;e.preventDefault();isValidCaptcha=validateCaptcha();isValidReceiver=validateReceiver();if(!(!isValidCaptcha||!isValidReceiver)){_context.next=6;break;}return _context.abrupt(\"return\",null);case 6:referalCode=localStorage.getItem(\"ref\");_context.next=9;return fetch(\"\".concat(serveUrl,\"/newOrder/\").concat(receiveAmount,\"/\").concat(toCurrency.shortName,\"/\").concat(sendAmount,\"/\").concat(fromCurrency.shortName,\"/\").concat(receiver,\"/\").concat(email,\"/\").concat(referalCode||\"null\",\"/pending\"),{method:\"GET\"}).then(function(res){return res.json();});case 9:res=_context.sent;if(!res.orderId){_context.next=18;break;}_context.next=13;return fetch(\"\".concat(serveUrl,\"/order/\").concat(res.orderId)).then(function(res){return res.json();});case 13:order=_context.sent;dispatch(dispatchOrder(order));navigate(\"/order/\".concat(res.orderId));_context.next=19;break;case 18:throw new Error(\"something went wrong with order id\");case 19:_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](0);console.error(_context.t0.message);case 24:case\"end\":return _context.stop();}},_callee,null,[[0,21]]);}));return function sendForm(_x,_x2,_x3){return _ref.apply(this,arguments);};}();return{sendForm:sendForm};};export default useForm;","map":{"version":3,"names":["useNavigate","serveUrl","useAppDispatch","useAppSelector","dispatchCaptchaIsValid","dispatchIsValidReceiver","dispatchOrder","generateCaptcha","useForm","state","exchange","captcha","email","receiver","fromCurrency","toCurrency","dispatch","navigate","validateCaptcha","Number","num1","num2","result","validateReceiver","regex","test","sendForm","e","sendAmount","receiveAmount","preventDefault","isValidCaptcha","isValidReceiver","referalCode","localStorage","getItem","fetch","shortName","method","then","res","json","orderId","order","Error","console","error","message"],"sources":["C:/Users/diarrhea/Documents/exchangePro-main/client/src/screens/home/components/exchange/components/form/hooks/useForm.ts"],"sourcesContent":["import { useNavigate } from \"react-router-dom\";\nimport { serveUrl } from \"../../../../../../../config\";\nimport {\n  useAppDispatch,\n  useAppSelector,\n} from \"../../../../../../../store/hooks\";\nimport {\n  dispatchCaptchaIsValid,\n  dispatchIsValidReceiver,\n  dispatchOrder,\n  generateCaptcha,\n} from \"../../../../../../../store/slices/exchange\";\n\nconst useForm = () => {\n  const { captcha, email, receiver, fromCurrency, toCurrency } = useAppSelector(\n    (state) => state.exchange\n  );\n\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n\n  const validateCaptcha = () => {\n    if (\n      Number(captcha.num1) + Number(captcha.num2) ===\n      Number(captcha.result)\n    ) {\n      dispatch(dispatchCaptchaIsValid(true));\n      return true;\n    }\n\n    dispatch(dispatchCaptchaIsValid(false));\n    dispatch(generateCaptcha());\n    return false;\n  };\n\n  const validateReceiver = () => {\n    const regex = /^[A-Za-z0-9]{5,100}$/; //^[A-Za-z0-9]{5,100}[0-9a-fA-F]+$/i; //^(0x){1}[0-9a-fA-F]{40}$/i;\n\n    if (regex.test(receiver)) {\n      dispatch(dispatchIsValidReceiver(true));\n      return true;\n    }\n\n    dispatch(dispatchIsValidReceiver(false));\n    return false;\n  };\n\n  const sendForm = async (\n    e: React.FormEvent<HTMLFormElement>,\n    sendAmount: string,\n    receiveAmount: string\n  ) => {\n    try {\n      e.preventDefault();\n\n      const isValidCaptcha = validateCaptcha();\n      const isValidReceiver = validateReceiver();\n\n      if (!isValidCaptcha || !isValidReceiver) return null;\n\n      const referalCode = localStorage.getItem(\"ref\");\n\n      const res = await fetch(\n        `${serveUrl}/newOrder/${receiveAmount}/${\n          toCurrency.shortName\n        }/${sendAmount}/${fromCurrency.shortName}/${receiver}/${email}/${\n          referalCode || \"null\"\n        }/pending`,\n        {\n          method: \"GET\",\n        }\n      ).then((res) => res.json());\n\n      if (res.orderId) {\n        const order = await fetch(`${serveUrl}/order/${res.orderId}`).then(\n          (res) => res.json()\n        );\n\n        dispatch(dispatchOrder(order));\n\n        navigate(`/order/${res.orderId}`);\n      } else {\n        throw new Error(\"something went wrong with order id\");\n      }\n    } catch (error: any) {\n      console.error(error.message);\n    }\n  };\n\n  return {\n    sendForm,\n  };\n};\n\nexport default useForm;\n"],"mappings":"kSAAA,OAASA,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OACEC,cAAc,CACdC,cAAc,KACT,kCAAkC,CACzC,OACEC,sBAAsB,CACtBC,uBAAuB,CACvBC,aAAa,CACbC,eAAe,KACV,4CAA4C,CAEnD,GAAMC,QAAO,CAAG,QAAVA,QAAO,EAAS,CACpB,oBAA+DL,cAAc,CAC3E,SAACM,KAAK,QAAKA,MAAK,CAACC,QAAQ,GAC1B,CAFOC,OAAO,iBAAPA,OAAO,CAAEC,KAAK,iBAALA,KAAK,CAAEC,QAAQ,iBAARA,QAAQ,CAAEC,YAAY,iBAAZA,YAAY,CAAEC,UAAU,iBAAVA,UAAU,CAI1D,GAAMC,SAAQ,CAAGd,cAAc,EAAE,CACjC,GAAMe,SAAQ,CAAGjB,WAAW,EAAE,CAE9B,GAAMkB,gBAAe,CAAG,QAAlBA,gBAAe,EAAS,CAC5B,GACEC,MAAM,CAACR,OAAO,CAACS,IAAI,CAAC,CAAGD,MAAM,CAACR,OAAO,CAACU,IAAI,CAAC,GAC3CF,MAAM,CAACR,OAAO,CAACW,MAAM,CAAC,CACtB,CACAN,QAAQ,CAACZ,sBAAsB,CAAC,IAAI,CAAC,CAAC,CACtC,MAAO,KAAI,CACb,CAEAY,QAAQ,CAACZ,sBAAsB,CAAC,KAAK,CAAC,CAAC,CACvCY,QAAQ,CAACT,eAAe,EAAE,CAAC,CAC3B,MAAO,MAAK,CACd,CAAC,CAED,GAAMgB,iBAAgB,CAAG,QAAnBA,iBAAgB,EAAS,CAC7B,GAAMC,MAAK,CAAG,sBAAsB,CAAE;AAEtC,GAAIA,KAAK,CAACC,IAAI,CAACZ,QAAQ,CAAC,CAAE,CACxBG,QAAQ,CAACX,uBAAuB,CAAC,IAAI,CAAC,CAAC,CACvC,MAAO,KAAI,CACb,CAEAW,QAAQ,CAACX,uBAAuB,CAAC,KAAK,CAAC,CAAC,CACxC,MAAO,MAAK,CACd,CAAC,CAED,GAAMqB,SAAQ,4FAAG,iBACfC,CAAmC,CACnCC,UAAkB,CAClBC,aAAqB,4LAGnBF,CAAC,CAACG,cAAc,EAAE,CAEZC,cAAc,CAAGb,eAAe,EAAE,CAClCc,eAAe,CAAGT,gBAAgB,EAAE,MAEtC,CAACQ,cAAc,EAAI,CAACC,eAAe,0DAAS,IAAI,SAE9CC,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC,uBAE7BC,MAAK,WAClBnC,QAAQ,sBAAa4B,aAAa,aACnCd,UAAU,CAACsB,SAAS,aAClBT,UAAU,aAAId,YAAY,CAACuB,SAAS,aAAIxB,QAAQ,aAAID,KAAK,aAC3DqB,WAAW,EAAI,MAAM,aAEvB,CACEK,MAAM,CAAE,KACV,CAAC,CACF,CAACC,IAAI,CAAC,SAACC,GAAG,QAAKA,IAAG,CAACC,IAAI,EAAE,GAAC,QATrBD,GAAG,mBAWLA,GAAG,CAACE,OAAO,iDACON,MAAK,WAAInC,QAAQ,mBAAUuC,GAAG,CAACE,OAAO,EAAG,CAACH,IAAI,CAChE,SAACC,GAAG,QAAKA,IAAG,CAACC,IAAI,EAAE,GACpB,SAFKE,KAAK,eAIX3B,QAAQ,CAACV,aAAa,CAACqC,KAAK,CAAC,CAAC,CAE9B1B,QAAQ,kBAAWuB,GAAG,CAACE,OAAO,EAAG,CAAC,oCAE5B,IAAIE,MAAK,CAAC,oCAAoC,CAAC,0FAGvDC,OAAO,CAACC,KAAK,CAAC,YAAMC,OAAO,CAAC,CAAC,oEAEhC,kBAxCKrB,SAAQ,oDAwCb,CAED,MAAO,CACLA,QAAQ,CAARA,QACF,CAAC,CACH,CAAC,CAED,cAAelB,QAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}