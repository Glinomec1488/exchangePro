{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport { serveUrl } from \"../../config\";\nimport { io } from \"socket.io-client\";\nimport { chechUserChatBan, chechUserId } from \"../../helpers\";\nconst useChat = () => {\n  _s();\n  const [isChatBanned, setIsChatBanned] = useState(null);\n  useEffect(() => {\n    const fetchChatStatus = async () => {\n      const result = await chechUserChatBan(); // Call the async function\n      setIsChatBanned(result); // Update state with the result\n    };\n    fetchChatStatus();\n  }, []); // Empty dependency array ensures this runs only on mount\n  const [messages, setMessages] = useState([\n    /*{\n      id: 1,\n      text: \"Hello my friend!\",\n      createdAt: \"2021-07-21 12:09:12\",\n      user: {\n        id: 1,\n      },\n    },\n    {\n      id: 2,\n      text: \"Hello!\",\n      createdAt: \"2021-07-21 14:09:12\",\n      user: {\n        id: 2,\n      },\n    },*/\n  ]);\n  const getHistoy = async () => {\n    const history = await fetch(`${serveUrl}/msgHistory/${localStorage.getItem(\"userId\")}`).then(res => res.json());\n    if (history.length > 0) {\n      setMessages(history.map(elem => ({\n        id: elem.id,\n        text: elem.text,\n        createdAt: elem.timestamp,\n        user: {\n          id: elem.user === \"true\" ? 2 : 1\n        }\n      })));\n    }\n  };\n  const sendMessage = async message => {\n    const messageTextEncoded = encodeURIComponent(message.text);\n    const timestamp = new Date().getTime();\n    await fetch(`${serveUrl}/msgSave/${messageTextEncoded}/${localStorage.getItem(\"userId\")}/${timestamp}/true`, {\n      method: \"POST\"\n    });\n    getHistoy();\n  };\n  useEffect(() => {\n    const socket = io(serveUrl);\n    socket.on(`hideChat_${localStorage.getItem(\"userId\")}`, async () => {\n      try {\n        chechUserId();\n        //window.location.reload();\n      } catch (error) {\n        console.error(error.message);\n      }\n    });\n    const timer = setInterval(() => {\n      getHistoy();\n    }, 50000);\n    return () => clearInterval(timer);\n  });\n  return {\n    messages,\n    sendMessage,\n    isChatBanned\n  };\n};\n_s(useChat, \"TkI/xp5kJs0Of0BY/bwXMrEyaSo=\");\nexport default useChat;","map":{"version":3,"names":["useState","useEffect","serveUrl","io","chechUserChatBan","chechUserId","useChat","_s","isChatBanned","setIsChatBanned","fetchChatStatus","result","messages","setMessages","getHistoy","history","fetch","localStorage","getItem","then","res","json","length","map","elem","id","text","createdAt","timestamp","user","sendMessage","message","messageTextEncoded","encodeURIComponent","Date","getTime","method","socket","on","error","console","timer","setInterval","clearInterval"],"sources":["C:/Users/1/Videos/exchangePro-main/client/src/components/chat/useChat.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from \"react\";\nimport { useAppSelector } from \"../../store/hooks\";\nimport { Message } from \"react-simple-chat\";\nimport { serveUrl } from \"../../config\";\nimport { io } from \"socket.io-client\";\nimport { chechUserChatBan, chechUserId } from \"../../helpers\";\n\nconst useChat = () => {\n  const [isChatBanned, setIsChatBanned] = useState<boolean | null>(null);\n  useEffect(() => {\n    const fetchChatStatus = async () => {\n      const result = await chechUserChatBan(); // Call the async function\n      setIsChatBanned(result); // Update state with the result\n    };\n\n    fetchChatStatus();\n  }, []); // Empty dependency array ensures this runs only on mount\n  const [messages, setMessages] = useState<Message[]>([\n    /*{\n      id: 1,\n      text: \"Hello my friend!\",\n      createdAt: \"2021-07-21 12:09:12\",\n      user: {\n        id: 1,\n      },\n    },\n    {\n      id: 2,\n      text: \"Hello!\",\n      createdAt: \"2021-07-21 14:09:12\",\n      user: {\n        id: 2,\n      },\n    },*/\n  ]);\n\n  const getHistoy = async () => {\n    const history = await fetch(\n      `${serveUrl}/msgHistory/${localStorage.getItem(\"userId\")}`\n    ).then((res) => res.json());\n\n    if (history.length > 0) {\n      setMessages(\n        history.map((elem: any) => ({\n          id: elem.id,\n          text: elem.text,\n          createdAt: elem.timestamp,\n          user: {\n            id: elem.user === \"true\" ? 2 : 1,\n          },\n        }))\n      );\n    }\n  };\n\n  const sendMessage = async (message: Message) => {\n    const messageTextEncoded = encodeURIComponent(message.text);\n    const timestamp = new Date().getTime();\n    await fetch(\n      `${serveUrl}/msgSave/${messageTextEncoded}/${localStorage.getItem(\n        \"userId\"\n      )}/${timestamp}/true`,\n      {\n        method: \"POST\",\n      }\n    );\n\n    getHistoy();\n  };\n\n  useEffect(() => {\n    const socket = io(serveUrl);\n\n    socket.on(`hideChat_${localStorage.getItem(\"userId\")}`, async () => {\n      try {\n        chechUserId();\n        //window.location.reload();\n      } catch (error: any) {\n        console.error(error.message);\n      }\n    });\n\n    const timer = setInterval(() => {\n      getHistoy();\n    }, 50000);\n\n    return () => clearInterval(timer);\n  });\n\n  return {\n    messages,\n    sendMessage,\n    isChatBanned,\n  };\n};\n\nexport default useChat;\n"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAqB,OAAO;AAGxD,SAASC,QAAQ,QAAQ,cAAc;AACvC,SAASC,EAAE,QAAQ,kBAAkB;AACrC,SAASC,gBAAgB,EAAEC,WAAW,QAAQ,eAAe;AAE7D,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACpB,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGT,QAAQ,CAAiB,IAAI,CAAC;EACtEC,SAAS,CAAC,MAAM;IACd,MAAMS,eAAe,GAAG,MAAAA,CAAA,KAAY;MAClC,MAAMC,MAAM,GAAG,MAAMP,gBAAgB,CAAC,CAAC,CAAC,CAAC;MACzCK,eAAe,CAACE,MAAM,CAAC,CAAC,CAAC;IAC3B,CAAC;IAEDD,eAAe,CAAC,CAAC;EACnB,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;EACR,MAAM,CAACE,QAAQ,EAAEC,WAAW,CAAC,GAAGb,QAAQ,CAAY;IAClD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAfI,CAgBD,CAAC;EAEF,MAAMc,SAAS,GAAG,MAAAA,CAAA,KAAY;IAC5B,MAAMC,OAAO,GAAG,MAAMC,KAAK,CACzB,GAAGd,QAAQ,eAAee,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,EAC1D,CAAC,CAACC,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC;IAE3B,IAAIN,OAAO,CAACO,MAAM,GAAG,CAAC,EAAE;MACtBT,WAAW,CACTE,OAAO,CAACQ,GAAG,CAAEC,IAAS,KAAM;QAC1BC,EAAE,EAAED,IAAI,CAACC,EAAE;QACXC,IAAI,EAAEF,IAAI,CAACE,IAAI;QACfC,SAAS,EAAEH,IAAI,CAACI,SAAS;QACzBC,IAAI,EAAE;UACJJ,EAAE,EAAED,IAAI,CAACK,IAAI,KAAK,MAAM,GAAG,CAAC,GAAG;QACjC;MACF,CAAC,CAAC,CACJ,CAAC;IACH;EACF,CAAC;EAED,MAAMC,WAAW,GAAG,MAAOC,OAAgB,IAAK;IAC9C,MAAMC,kBAAkB,GAAGC,kBAAkB,CAACF,OAAO,CAACL,IAAI,CAAC;IAC3D,MAAME,SAAS,GAAG,IAAIM,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;IACtC,MAAMnB,KAAK,CACT,GAAGd,QAAQ,YAAY8B,kBAAkB,IAAIf,YAAY,CAACC,OAAO,CAC/D,QACF,CAAC,IAAIU,SAAS,OAAO,EACrB;MACEQ,MAAM,EAAE;IACV,CACF,CAAC;IAEDtB,SAAS,CAAC,CAAC;EACb,CAAC;EAEDb,SAAS,CAAC,MAAM;IACd,MAAMoC,MAAM,GAAGlC,EAAE,CAACD,QAAQ,CAAC;IAE3BmC,MAAM,CAACC,EAAE,CAAC,YAAYrB,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,YAAY;MAClE,IAAI;QACFb,WAAW,CAAC,CAAC;QACb;MACF,CAAC,CAAC,OAAOkC,KAAU,EAAE;QACnBC,OAAO,CAACD,KAAK,CAACA,KAAK,CAACR,OAAO,CAAC;MAC9B;IACF,CAAC,CAAC;IAEF,MAAMU,KAAK,GAAGC,WAAW,CAAC,MAAM;MAC9B5B,SAAS,CAAC,CAAC;IACb,CAAC,EAAE,KAAK,CAAC;IAET,OAAO,MAAM6B,aAAa,CAACF,KAAK,CAAC;EACnC,CAAC,CAAC;EAEF,OAAO;IACL7B,QAAQ;IACRkB,WAAW;IACXtB;EACF,CAAC;AACH,CAAC;AAACD,EAAA,CAvFID,OAAO;AAyFb,eAAeA,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}